name: GCP Deploy

on: 
  push:
    branches:
      - master

jobs:

  auth:
    runs-on: ubuntu-latest
    steps:
      - name: GCP Authenticate
        uses: actions/gcloud/auth@master
        with:
          GCLOUD_AUTH: ${{ secrets.GCLOUD_AUTH }}
  build:
    runs-on: ubuntu-latest
    needs: GCP Authenticate
    with:
        args: builds submit --tag gcr.io/second-scion-236722/hundred-game-backend
    steps:
      - name: GCP Build Container
        uses: actions/gcloud/cli@master
  deploy:
    runs-on: ubuntu-latest
    needs: GCP Build Container
    with:
      args: beta run deploy --image gcr.io/second-scion-236722/hundred-game-backend
    steps:
      - name: GCP Deploy Revision
        uses: actions/gcloud/cli@master
